package chaskey

import (
	"encoding/binary"
	"testing"
)

var vectors = [64][4]uint32{
	{0x68AC5B20, 0xFA42C180, 0xFCACE45D, 0xB3C93E93},
	{0x81BA7C68, 0x7D4F7BC5, 0x791CB3C5, 0x385BFBE4},
	{0xCEEEE215, 0xC1139EF9, 0xA9395878, 0x89BD8DD9},
	{0xA71B5FBD, 0xF9FFBC18, 0x12436891, 0x5FDABC0B},
	{0x1DC20A83, 0x377B1253, 0x163D838A, 0x6009548E},
	{0xA7EE46C5, 0x276F8962, 0xEA2FFF26, 0xE1C67632},
	{0xCEA97EF2, 0x1D7CA8A2, 0xBEE2D876, 0x62DD2BB5},
	{0x81BA188C, 0xDB41FA76, 0x881D7B36, 0x27712D14},
	{0x47CD22E2, 0xB3914E18, 0xC0694867, 0xB94274B2},
	{0x964A5C2C, 0x8E98D213, 0x13026914, 0x953CF5A4},
	{0x15CDE0B4, 0x3C32B870, 0xE5EF118F, 0x903AAF04},
	{0xB9097949, 0x283D3594, 0x0B9C2409, 0x874F7560},
	{0x18601171, 0x4691A938, 0xA9A65AD5, 0x9AB89763},
	{0x92B3A2DE, 0x95F30273, 0xB206F5C9, 0xC82A9014},
	{0x7D0A03D7, 0xE850EB54, 0x3E5D355C, 0x7A303A13},
	{0x47F322F8, 0x48A57B18, 0xA1521524, 0xCBD33C5B},
	{0xA0E13A07, 0x853EE439, 0x0153EE16, 0xFC0B32EE},
	{0xE9CB534D, 0x99BCDDA7, 0x9210589C, 0x23F22CEC},
	{0xFDD86CBD, 0x9B082EA3, 0xB74FE819, 0xF4188EA9},
	{0xA92EF86C, 0x5F6A5E89, 0xCE67D647, 0xD012D92E},
	{0xB13639CC, 0x803AE20D, 0xE19D61DB, 0xCAFFF449},
	{0x31E2B066, 0x1CF26416, 0x7C463705, 0x5CD5A282},
	{0xA20FCEE6, 0xBC100222, 0x64FFCD90, 0x26D6E329},
	{0xE154A8A8, 0x81A5B86B, 0x9B14D685, 0xB1716E2D},
	{0x0C188056, 0xB8EC1529, 0x242F1879, 0x109BC8CD},
	{0x5C65D193, 0x6832E272, 0x972ADA66, 0xD5D75926},
	{0x9D8EB46C, 0x3ACAC540, 0x4EB83192, 0x5D6680BD},
	{0x10EBFCE0, 0x24392D67, 0x54B4A0ED, 0x234A2E6F},
	{0xEDF9BE35, 0x40A1A001, 0x108EDF87, 0x8B19F659},
	{0x35CDD269, 0x397F6B3A, 0x55771341, 0x7EA1B0ED},
	{0xEE3D54B2, 0x455EFE22, 0x7970C546, 0x26F4F807},
	{0x12E7FBFF, 0x0C0A54A4, 0x3CD71D74, 0x5A943B72},
	{0xA5BB9F7C, 0x4BCD36B9, 0x74C8FBC9, 0x7A366C1F},
	{0xA5C7E4B6, 0x62EF789B, 0xC38FE46B, 0x048D9A75},
	{0x7DD7FA3B, 0x26039BD0, 0x10E91F15, 0x941763CB},
	{0x1F087259, 0x7633EC81, 0x5AA58619, 0x2C6DC18F},
	{0x8CE06798, 0xA24DB75B, 0x210A1473, 0x51E179A7},
	{0x9D57C801, 0x54EA550C, 0x62946E3D, 0x912A9951},
	{0x7329916E, 0x5DEA7043, 0x8A031456, 0x6CE2D9B8},
	{0x0AC9D3AB, 0xBB4FD062, 0x7C130F94, 0x1355D435},
	{0x58693AB7, 0x57511346, 0x57A463B9, 0x062A867E},
	{0x56935B36, 0xFCF3E1D9, 0x66ABFECD, 0xAB585112},
	{0x2DC4F0CE, 0x1CE6012B, 0x87348179, 0x93D78762},
	{0xA59F0892, 0x6362D2AB, 0xB8938A80, 0xC28BBD69},
	{0x2A5DB0A4, 0xC4D1A998, 0x38EF8FB6, 0x87AA70B9},
	{0x1EFFC9FD, 0x9B7B9006, 0xF54A6AE6, 0xDFC46BFA},
	{0xA4F379DB, 0x89076394, 0xF424BFD1, 0xCC5CBD45},
	{0x34739F27, 0xCCE4110F, 0x5349F819, 0xB950A3F2},
	{0x5EA73B15, 0x0E294FEE, 0x9AFEF079, 0x2BFE1834},
	{0xCDF22D0D, 0x8B627FE0, 0xC66B0387, 0xFDF78B16},
	{0x08F87C7E, 0x018CF86D, 0x6625D7D0, 0xC979AC09},
	{0x4B5080A0, 0xD2514985, 0x04A2F417, 0xA7A742CA},
	{0x0BF3AC58, 0xA79E6124, 0x6BA13156, 0xC1E5E6DB},
	{0x14B44242, 0xB3CE3DA7, 0x8717DDD6, 0xA0DF84E8},
	{0x790A8844, 0x457FF131, 0xE41588C0, 0x84642930},
	{0x1A73090A, 0xD014402D, 0xFADD9966, 0x85C4B2DD},
	{0xA6AF417F, 0x9E0DFC68, 0xAA6320C4, 0xCA144E29},
	{0x427DBE31, 0xFC8E2F54, 0x36787C7D, 0x6DAF6959},
	{0x87BE68D3, 0xBAC0AE0F, 0x1A620D65, 0xAE3F9F32},
	{0x41F50CA3, 0xDEC9F46E, 0x78AA6FDA, 0x982F4CB3},
	{0x34576556, 0x291CFACB, 0xCF509C2F, 0x809CA30F},
	{0x7AD9A7EA, 0xF98DBBB6, 0xC6D42E36, 0x385A95E2},
	{0xAA43CBB3, 0xC34F1530, 0x003FAA9C, 0x114B51CB},
	{0x1F89E82C, 0x1EC2395D, 0x1EF7B167, 0x5E6B129D},
}

func TestVectors(t *testing.T) {

	var m [64]byte
	k := [4]uint32{0x833D3433, 0x009F389F, 0x2398E64F, 0x417ACF39}

	var tag [16]byte

	h := New(k)

	for i := 0; i < 64; i++ {
		m[i] = byte(i)

		h.MAC(m[:i], tag[:])

		t32 := [4]uint32{
			binary.LittleEndian.Uint32(tag[:]),
			binary.LittleEndian.Uint32(tag[4:]),
			binary.LittleEndian.Uint32(tag[8:]),
			binary.LittleEndian.Uint32(tag[12:]),
		}

		if t32 != vectors[i] {
			t.Errorf("chaskey([0x00..0x%02x])=%x, want %08x\n", i, t32, vectors[i])
		}
	}
}
